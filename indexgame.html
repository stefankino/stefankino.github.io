<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数独游戏</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .timer, .difficulty {
            font-size: 18px;
            font-weight: bold;
        }
        
        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-gap: 1px;
            background-color: #333;
            border: 2px solid #333;
            width: 450px;
            height: 450px;
        }
        
        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        
        .cell:hover {
            background-color: #f0f0f0;
        }
        
        .cell.selected {
            background-color: #e0f7fa;
        }
        
        .cell.fixed {
            font-weight: bold;
            color: #333;
        }
        
        .cell.error {
            color: red;
        }
        
        .cell.hint {
            color: green;
        }
        
        /* 3x3 区域边框 */
        .cell[data-col="2"], .cell[data-col="5"] {
            border-right: 2px solid #333;
        }
        
        .cell[data-row="2"], .cell[data-row="5"] {
            border-bottom: 2px solid #333;
        }
        
        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 5px;
            margin-top: 20px;
            width: 300px;
        }
        
        .number-btn, .action-btn {
            padding: 10px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #e0e0e0;
        }
        
        .number-btn:hover, .action-btn:hover {
            background-color: #d0d0d0;
        }
        
        .action-btn {
            background-color: #4caf50;
            color: white;
            grid-column: span 2;
        }
        
        .action-btn.danger {
            background-color: #f44336;
        }
        
        .action-btn.warning {
            background-color: #ff9800;
        }
        
        .action-btn.info {
            background-color: #2196f3;
        }
        
        .message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #2e7d32;
        }
        
        .message.error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #c62828;
        }
    </style>
</head>
<body>
    <h1>数独游戏</h1>
    <div class="game-container">
        <div class="info">
            <div class="timer">时间: 00:00</div>
            <div class="difficulty">难度: 中等</div>
        </div>
        <div class="controls">
            <button id="new-game" class="action-btn">新游戏</button>
            <select id="difficulty-select">
                <option value="easy">简单</option>
                <option value="medium" selected>中等</option>
                <option value="hard">困难</option>
                <option value="expert">专家</option>
            </select>
            <button id="check" class="action-btn info">检查</button>
            <button id="hint" class="action-btn warning">提示</button>
            <button id="solve" class="action-btn danger">解答</button>
        </div>
        <div class="sudoku-grid" id="grid"></div>
        <div class="number-pad">
            <button class="number-btn" data-number="1">1</button>
            <button class="number-btn" data-number="2">2</button>
            <button class="number-btn" data-number="3">3</button>
            <button class="number-btn" data-number="4">4</button>
            <button class="number-btn" data-number="5">5</button>
            <button class="number-btn" data-number="6">6</button>
            <button class="number-btn" data-number="7">7</button>
            <button class="number-btn" data-number="8">8</button>
            <button class="number-btn" data-number="9">9</button>
            <button class="number-btn" data-number="0">清除</button>
        </div>
        <div id="message" class="message"></div>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            board: Array(9).fill().map(() => Array(9).fill(0)),
            solution: Array(9).fill().map(() => Array(9).fill(0)),
            fixed: Array(9).fill().map(() => Array(9).fill(false)),
            selectedCell: null,
            startTime: null,
            timerInterval: null,
            difficulty: 'medium',
            hintsUsed: 0
        };

        // DOM 元素
        const grid = document.getElementById('grid');
        const timerDisplay = document.querySelector('.timer');
        const difficultyDisplay = document.querySelector('.difficulty');
        const difficultySelect = document.getElementById('difficulty-select');
        const newGameBtn = document.getElementById('new-game');
        const checkBtn = document.getElementById('check');
        const hintBtn = document.getElementById('hint');
        const solveBtn = document.getElementById('solve');
        const messageDiv = document.getElementById('message');
        const numberBtns = document.querySelectorAll('.number-btn');

        // 初始化游戏
        function initGame() {
            createGrid();
            newGame();
            
            // 事件监听器
            newGameBtn.addEventListener('click', newGame);
            checkBtn.addEventListener('click', checkSolution);
            hintBtn.addEventListener('click', getHint);
            solveBtn.addEventListener('click', showSolution);
            difficultySelect.addEventListener('change', () => {
                gameState.difficulty = difficultySelect.value;
                difficultyDisplay.textContent = `难度: ${getDifficultyText()}`;
            });
            
            numberBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (gameState.selectedCell) {
                        const number = parseInt(btn.dataset.number);
                        const [row, col] = gameState.selectedCell;
                        if (!gameState.fixed[row][col]) {
                            gameState.board[row][col] = number;
                            updateGrid();
                            
                            // 检查是否完成
                            if (isBoardFilled() && isCorrect()) {
                                showMessage('恭喜！你成功解决了这个数独！', 'success');
                                stopTimer();
                            }
                        }
                    }
                });
            });
        }

        // 创建网格
        function createGrid() {
            grid.innerHTML = '';
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    cell.addEventListener('click', () => {
                        // 取消之前选中的单元格
                        if (gameState.selectedCell) {
                            const [prevRow, prevCol] = gameState.selectedCell;
                            document.querySelector(`.cell[data-row="${prevRow}"][data-col="${prevCol}"]`).classList.remove('selected');
                        }
                        
                        // 选中当前单元格
                        gameState.selectedCell = [row, col];
                        cell.classList.add('selected');
                    });
                    
                    grid.appendChild(cell);
                }
            }
        }

        // 更新网格显示
        function updateGrid() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                    const value = gameState.board[row][col];
                    
                    cell.textContent = value === 0 ? '' : value;
                    cell.classList.remove('fixed', 'error', 'hint');
                    
                    if (gameState.fixed[row][col]) {
                        cell.classList.add('fixed');
                    }
                }
            }
        }

        // 开始新游戏
        function newGame() {
            stopTimer();
            resetGameState();
            generateSudoku();
            updateGrid();
            startTimer();
            hideMessage();
        }

        // 重置游戏状态
        function resetGameState() {
            gameState.board = Array(9).fill().map(() => Array(9).fill(0));
            gameState.solution = Array(9).fill().map(() => Array(9).fill(0));
            gameState.fixed = Array(9).fill().map(() => Array(9).fill(false));
            gameState.selectedCell = null;
            gameState.hintsUsed = 0;
        }

        // 生成数独
        function generateSudoku() {
            // 生成完整解决方案
            generateSolution(0, 0);
            
            // 复制解决方案
            gameState.solution = gameState.board.map(row => [...row]);
            
            // 根据难度移除数字
            const cellsToRemove = getDifficultyRemovalCount();
            removeNumbers(cellsToRemove);
            
            // 标记固定单元格
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    gameState.fixed[row][col] = gameState.board[row][col] !== 0;
                }
            }
        }

        // 递归生成有效的数独解决方案
        function generateSolution(row, col) {
            if (row === 9) {
                return true;
            }
            
            if (col === 9) {
                return generateSolution(row + 1, 0);
            }
            
            const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            shuffleArray(numbers);
            
            for (const num of numbers) {
                if (isValidPlacement(row, col, num)) {
                    gameState.board[row][col] = num;
                    
                    if (generateSolution(row, col + 1)) {
                        return true;
                    }
                    
                    gameState.board[row][col] = 0;
                }
            }
            
            return false;
        }

        // 检查放置数字是否有效
        function isValidPlacement(row, col, num) {
            // 检查行
            for (let c = 0; c < 9; c++) {
                if (gameState.board[row][c] === num) {
                    return false;
                }
            }
            
            // 检查列
            for (let r = 0; r < 9; r++) {
                if (gameState.board[r][col] === num) {
                    return false;
                }
            }
            
            // 检查3x3方格
            const boxRow = Math.floor(row / 3) * 3;
            const boxCol = Math.floor(col / 3) * 3;
            
            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    if (gameState.board[boxRow + r][boxCol + c] === num) {
                        return false;
                    }
                }
            }
            
            return true;
        }

        // 随机打乱数组
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // 根据难度移除数字
        function removeNumbers(count) {
            const positions = [];
            
            // 创建所有位置的列表
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    positions.push([row, col]);
                }
            }
            
            // 随机打乱位置
            shuffleArray(positions);
            
            // 移除指定数量的数字
            for (let i = 0; i < count && i < positions.length; i++) {
                const [row, col] = positions[i];
                gameState.board[row][col] = 0;
            }
        }

        // 根据难度获取要移除的单元格数量
        function getDifficultyRemovalCount() {
            switch (gameState.difficulty) {
                case 'easy': return 30;
                case 'medium': return 40;
                case 'hard': return 50;
                case 'expert': return 60;
                default: return 40;
            }
        }

        // 获取难度文本
        function getDifficultyText() {
            switch (gameState.difficulty) {
                case 'easy': return '简单';
                case 'medium': return '中等';
                case 'hard': return '困难';
                case 'expert': return '专家';
                default: return '中等';
            }
        }

        // 检查解答
        function checkSolution() {
            let hasError = false;
            
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                    cell.classList.remove('error');
                    
                    if (gameState.board[row][col] !== 0 && gameState.board[row][col] !== gameState.solution[row][col]) {
                        cell.classList.add('error');
                        hasError = true;
                    }
                }
            }
            
            if (hasError) {
                showMessage('有些数字不正确，请检查标红的单元格。', 'error');
            } else if (isBoardFilled()) {
                showMessage('恭喜！你成功解决了这个数独！', 'success');
                stopTimer();
            } else {
                showMessage('到目前为止一切正确，继续加油！', 'success');
            }
        }

        // 获取提示
        function getHint() {
            if (!gameState.selectedCell) {
                showMessage('请先选择一个单元格获取提示。', 'error');
                return;
            }
            
            const [row, col] = gameState.selectedCell;
            
            if (gameState.fixed[row][col]) {
                showMessage('这是一个固定的单元格，不能修改。', 'error');
                return;
            }
            
            if (gameState.board[row][col] === gameState.solution[row][col]) {
                showMessage('这个单元格已经正确了！', 'success');
                return;
            }
            
            gameState.board[row][col] = gameState.solution[row][col];
            gameState.hintsUsed++;
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('hint');
            
            updateGrid();
            
            if (isBoardFilled() && isCorrect()) {
                showMessage('恭喜！你成功解决了这个数独！', 'success');
                stopTimer();
            }
        }

        // 显示完整解答
        function showSolution() {
            if (confirm('确定要查看完整解答吗？这将结束当前游戏。')) {
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        gameState.board[row][col] = gameState.solution[row][col];
                    }
                }
                
                updateGrid();
                stopTimer();
                showMessage('这是完整的解答。点击"新游戏"开始新的挑战！', 'info');
            }
        }

        // 检查棋盘是否填满
        function isBoardFilled() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (gameState.board[row][col] === 0) {
                        return false;
                    }
                }
            }
            return true;
        }

        // 检查当前棋盘是否正确
        function isCorrect() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (gameState.board[row][col] !== gameState.solution[row][col]) {
                        return false;
                    }
                }
            }
            return true;
        }

        // 开始计时器
        function startTimer() {
            gameState.startTime = new Date();
            gameState.timerInterval = setInterval(updateTimer, 1000);
        }

        // 停止计时器
        function stopTimer() {
            clearInterval(gameState.timerInterval);
        }

        // 更新计时器显示
        function updateTimer() {
            const now = new Date();
            const elapsed = Math.floor((now - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `时间: ${minutes}:${seconds}`;
        }

        // 显示消息
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // 5秒后自动隐藏
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // 隐藏消息
        function hideMessage() {
            messageDiv.style.display = 'none';
        }

        // 初始化游戏
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
